[{"kind":1,"language":"markdown","value":"# Auto Recalls"},{"kind":2,"language":"malloy","value":"source: auto_recalls is table('duckdb:auto_recalls.csv') {\n  measure: \n    recall_count is count()\n    percent_of_recalls is recall_count/all(recall_count)*100\n    total_defects is `Potentially Affected`.sum()\n  dimension:\n      recall_url is concat(\n        'https://www.nhtsa.gov/recalls?nhtsaId=',\n        `NHTSA ID`\n    )\n\n  query: recent_recalls is {\n    group_by:\n      recall_date is `Report Received Date`::string\n      `NHTSA ID`\n      recall_url\n      Manufacturer\n      Subject\n      `Potentially Affected`\n    order_by: 1 desc\n    limit: 10\n  }\n\n  query: by_year is {\n    group_by: recall_year is year(`Report Received Date`)\n    aggregate:\n      recall_count\n    order_by: recall_year\n  }\n}"},{"kind":1,"language":"markdown","value":"## Recalls by Manufacturer"},{"kind":2,"language":"malloy","value":"query: auto_recalls -> {\n  group_by: Manufacturer\n  aggregate: \n    recall_count\n    percent_of_recalls\n    total_defects\n  limit: 10\n}"},{"kind":1,"language":"markdown","value":"## Recalls By Type"},{"kind":2,"language":"malloy","value":"  query: auto_recalls-> {\n    group_by: `Recall Type`\n    aggregate:\n      recall_count\n      percent_of_recalls\n  }"},{"kind":1,"language":"markdown","value":"## Recalls By Year"},{"kind":2,"language":"malloy","value":"  query: auto_recalls -> by_year\n// --! style line_chart"},{"kind":1,"language":"markdown","value":"## By Year by Manufacturer"},{"kind":2,"language":"malloy","value":"  query: auto_recalls -> {\n    nest: top_manufacturers is {\n      group_by: Manufacturer\n      aggregate: recall_count\n      limit: 5\n    }\n    nest: x is {\n      group_by: Manufacturer, recall_year is year(`Report Received Date`)\n      aggregate:\n        recall_count\n    }\n  }\n  -> {\n    where: top_manufacturers.Manufacturer = x.Manufacturer\n    group_by: x.recall_year, x.recall_count, x.Manufacturer,\n    limit: 100000\n    order_by: 1, 3\n  }\n // --! style line_chart "},{"kind":1,"language":"markdown","value":"## Biggest Recalls"},{"kind":2,"language":"malloy","value":"  query: auto_recalls-> recent_recalls + {\n    order_by: `Potentially Affected` desc\n  }"},{"kind":1,"language":"markdown","value":"## Dashboard "},{"kind":2,"language":"malloy","value":"query: auto_recalls-> {\n  group_by: Manufacturer\n  aggregate: recall_count\n  nest: by_year_line_chart is by_year + {group_by: `Recall Type`}\n  nest: recent_recalls + {limit: 6}\n  nest: biggest_recalls  is recent_recalls + {\n    order_by: `Potentially Affected` desc\n    limit: 6\n  }\n}\n// --! style dashboard"}]